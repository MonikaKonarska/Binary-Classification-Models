---
title: "Who are the borrowers ?"
output: html_document
---

## *Let's get more information about the borrowers.* 

```{r setup, echo = FALSE, message=FALSE, warning=FALSE }
library("tm")
library("SnowballC")
library("wordcloud")
library("RColorBrewer")
library("tidyverse")
library("data.table")
source("functions.R")
set.seed(1234)
```

From data LC (from 2013-01-01 to 2015-06-30) selected samples of variable `empl_title`. Created three datasets (the sample of all borrowers, the sample of borrowers who didn't pay off loan and the sample of borrowers who paid off).   


```{r prepareData, echo = FALSE, message = FALSE, warning = FALSE}

dataPath <- file.path(getwd(), "data")
data <- fread(file.path(dataPath, "loan.csv"))
data <- setDF(data)

data <- data %>% mutate(funded_loan_date = convert_date_from_month_year(issue_d),
                        earliest_cr_line_date = convert_date_from_month_year(earliest_cr_line),
                        last_credit_pull_date = convert_date_from_month_year(last_credit_pull_d)) 

dataReduced <- data[which(data$funded_loan_date >= '2013-01-01' & data$funded_loan_date <= '2015-06-30'), ]

dataReduced$target <- factor(case_when(dataReduced$loan_status == "Fully Paid"  ~ 0,
                                       dataReduced$loan_status == "Charged Off" ~ 1,
                                       dataReduced$loan_status == "Default Does not meet the credit policy. Status:Charged Off" ~ 1), levels = c(0, 1))

dataReduced <- dataReduced[which(!is.na(dataReduced$target)), ]

borrowesAll <- sample(x = dataReduced$emp_title, size = 50000 )
borrowersWithDefault <- dataReduced[which(dataReduced$target == 1), "emp_title"]
borrowersWithoutDefault <- dataReduced[which(dataReduced$target == 0), "emp_title"]  
borrowersWithoutDefault <- sample(x = borrowersWithoutDefault, size = 30000)  
```

Here the some examples of employment title.
```{r exampleOfEmps, echo = FALSE, message = FALSE, warning = FALSE}
head(borrowesAll, 100)
```


### **Word Cloud of borrowers employment** 


### Converting the text file into a Corpus

```{r corpus, echo = TRUE, message = FALSE, warning = FALSE }
docsBorrowersAll <- Corpus(VectorSource(borrowesAll))
docsBorrowersDefault <- Corpus(VectorSource(borrowersWithDefault))
docsBorrowersWithoutDefault <- Corpus(VectorSource(borrowersWithoutDefault))
```


### Text cleaning
Used function `tm_map()` from the `tm` package for processing text. It is some operations on the text:

* strip unnecessary white space,  
* convert everything to lower case,  
* remove numbers and punctuation with the removeNumbers and removePunctuation arguments.

```{r cleaningText, echo = TRUE, message = FALSE, warning = FALSE}
borrowesAll_tm <- tm_map(docsBorrowersAll, stripWhitespace)
borrowesAll_tm <- tm_map(borrowesAll_tm, tolower)
borrowesAll_tm <- tm_map(borrowesAll_tm, removeNumbers)
borrowesAll_tm <- tm_map(borrowesAll_tm, removePunctuation)
borrowesAll_tm <- tm_map(borrowesAll_tm, removeWords, stopwords('english'))

docsBorrowersDefault_tm <- tm_map(docsBorrowersDefault, stripWhitespace)
docsBorrowersDefault_tm <- tm_map(docsBorrowersDefault_tm, tolower)
docsBorrowersDefault_tm <- tm_map(docsBorrowersDefault_tm, removeNumbers)
docsBorrowersDefault_tm <- tm_map(docsBorrowersDefault_tm, removePunctuation)
docsBorrowersDefault_tm <- tm_map(docsBorrowersDefault_tm, removeWords, stopwords('english'))

docsBorrowersWithoutDefault_tm <- tm_map(docsBorrowersWithoutDefault, stripWhitespace)
docsBorrowersWithoutDefault_tm <- tm_map(docsBorrowersWithoutDefault_tm, tolower)
docsBorrowersWithoutDefault_tm <- tm_map(docsBorrowersWithoutDefault_tm, removeNumbers)
docsBorrowersWithoutDefault_tm <- tm_map(docsBorrowersWithoutDefault_tm, removePunctuation)
docsBorrowersWithoutDefault_tm <- tm_map(docsBorrowersWithoutDefault_tm, removeWords, stopwords('english'))
```


##### Creating word clouds

```{r clouds, echo = TRUE, message = FALSE, warning = FALSE}

wordcloud (docsBorrowersWithoutDefault_tm,
           scale=c(5,0.5),
           max.words=200,
           random.order=FALSE, rot.per=0.35, use.r.layout=FALSE, colors=brewer.pal(8, 'Dark2'))

wordcloud (docsBorrowersDefault_tm,
           scale=c(5,0.5),
           max.words=200,
           random.order=FALSE, rot.per=0.35, use.r.layout=FALSE, colors=brewer.pal(8, 'Dark2'))

wordcloud (borrowesAll_tm,
           scale=c(5,0.5),
           max.words=200,
           random.order=FALSE, rot.per=0.35, use.r.layout=FALSE, colors=brewer.pal(8, 'Dark2'))
```

